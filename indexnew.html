<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Kinetic Login</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #ffffff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- BACKGROUND ANIMATION CONTAINER --- */
        .bg-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            display: flex;
            flex-direction: column; /* Stack rows vertically */
            justify-content: space-between; /* Spread them out evenly */
            opacity: 0.15;
            pointer-events: none;
        }

        /* --- TEXT STYLING --- */
        .scroll-lane {
            display: flex;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            /* Default size, we will vary this in HTML */
            font-size: 2rem; 
            text-transform: uppercase; 
            line-height: 1.1; /* Tighter line height for full wall effect */
            color: #000;
            width: 100%;
        }

        .scroll-lane span {
            padding-right: 50px;
        }
        
        .keyword { font-weight: 900; text-decoration: underline; }
        .def { font-style: italic; font-weight: 300; }
        .meta { font-weight: bold; letter-spacing: 2px; }

        /* --- ANIMATIONS (SLOWED DOWN) --- */
        /* Note: Durations increased to 80s - 120s */

        .scroll-left .track {
            display: flex;
            animation: scroll-left 100s linear infinite;
        }
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .scroll-right .track {
            display: flex;
            animation: scroll-right 110s linear infinite;
        }
        @keyframes scroll-right {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(0); }
        }

        /* --- VERTICAL OVERLAY --- */
        .vertical-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0; /* Sit on top of horizontal text */
        }

        .vertical-lane {
            position: absolute;
            top: -50%;
            height: 200%;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            display: flex;
            align-items: center;
            opacity: 0.6; /* Slightly darker than horizontal for contrast */
        }
        
        .scroll-down .track {
            animation: scroll-down 80s linear infinite;
        }
        @keyframes scroll-down {
            0% { transform: translateY(-50%); }
            100% { transform: translateY(0); }
        }

        .scroll-up .track {
            animation: scroll-up 90s linear infinite;
        }
        @keyframes scroll-up {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50%); }
        }

        /* --- LOGIN/SIGNUP CARDS --- */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            z-index: 10;
            position: relative;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border: 2px solid #000;
            width: 350px;
            box-shadow: 12px 12px 0px #000;
        }

        .auth-card h1 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            border-bottom: 2px solid #000;
            padding-bottom: 0.5rem;
        }

        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .input-group input { width: 100%; padding: 0.8rem; border: 2px solid #000; font-family: 'Courier New', Courier, monospace; background: #fff; }
        
        button {
            width: 100%; padding: 1rem; background: #000; color: #fff; border: none;
            font-family: 'Courier New', Courier, monospace; font-weight: bold; font-size: 1rem;
            cursor: pointer; margin-top: 1rem; text-transform: uppercase;
        }
        button:hover { background: #333; }

        .auth-options {
            text-align: center;
            margin-bottom: 1rem;
        }
        .auth-options button {
            width: auto;
            margin: 0 0.5rem;
            padding: 0.5rem 1rem;
            background: #fff;
            color: #000;
            border: 2px solid #000;
        }
        .auth-options button:hover { background: #000; color: #fff; }

        .google-login {
            text-align: center;
            margin-bottom: 1rem;
        }
        .google-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: #fff;
            border: 2px solid #4285f4;
            border-radius: 4px;
            color: #4285f4;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.2s;
        }
        .google-btn:hover { background: #f8f9fa; }
        .google-btn img { width: 18px; height: 18px; }

        .divider {
            text-align: center;
            margin: 1rem 0;
            position: relative;
            color: #666;
        }
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }
        .divider::after {
            content: 'or';
            background: white;
            padding: 0 1rem;
            position: relative;
            z-index: 1;
        }

        /* Specific styles for variation */
        .tiny { font-size: 1rem; opacity: 0.7; }
        .huge { font-size: 4rem; opacity: 0.2; font-weight: bold; }
        .med { font-size: 2.2rem; }

        .v-1 { left: 15%; font-size: 1.5rem; }
        .v-2 { left: 85%; font-size: 1.5rem; }
        .v-3 { left: 5%; font-size: 1rem; opacity: 0.4; }
        .v-4 { left: 92%; font-size: 1rem; opacity: 0.4; }

        /* --- MAIN APP STYLES --- */
        .main-app {
            display: none;
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .top-nav {
            background: linear-gradient(135deg, #000000 0%, #000000 100%);
            color: white;
            padding: 0 2rem;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .logo { display: flex; align-items: center; gap: 0.75rem; font-size: 1.25rem; font-weight: 700; }
        .user-menu { display: flex; align-items: center; gap: 1.5rem; }
        .user-info { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 8px; transition: background 0.2s; }
        .user-info:hover { background: rgba(255,255,255,0.1); }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background: white; color: #6bfcf7; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .logout-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 0.875rem; font-weight: 500; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }

        .sidebar { position: fixed; left: 0; top: 60px; bottom: 0; width: 260px; background: white; border-right: 1px solid #e2e8f0; padding: 1.5rem 0; overflow-y: auto; z-index: 100; }
        .sidebar-section { margin-bottom: 1.5rem; }
        .sidebar-title { font-size: 0.75rem; font-weight: 600; color: #718096; text-transform: uppercase; letter-spacing: 0.05em; padding: 0 1.5rem; margin-bottom: 0.5rem; }
        .sidebar-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem; color: #4a5568; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; }
        .sidebar-item:hover { background: black; color: #f7fafc; }
        .sidebar-item.active { background: black; color: #eef2ff; border-left-color: #000000; font-weight: 600; }

        .main-content { margin-left: 260px; margin-top: 60px; padding: 2rem; min-height: calc(100vh - 60px); }

        .page-header { margin-bottom: 2rem; }
        .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: #1a202c; }
        .page-subtitle { color: #718096; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .stat-icon svg { width: 24px; height: 24px; color: white; }
        .stat-label { font-size: 0.875rem; color: #718096; margin-bottom: 0.25rem; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #1a202c; }

        .upload-section { background: rgb(255, 255, 255); border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .upload-zone { border: 2px dashed #cbd5e0; border-radius: 12px; padding: 3rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-zone:hover { border-color: #000000; background: #f7fafc; }

        .clause-card { background: white; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #cbd5e0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .risk-badge { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; }
        .risk-critical { background: rgba(220, 38, 38, 0.1); color: #dc2626; }
        .risk-high { background: rgba(249, 115, 22, 0.1); color: #f97316; }
        .risk-medium { background: rgba(234, 179, 8, 0.1); color: #eab308; }
        .risk-low { background: rgba(34, 197, 94, 0.1); color: #22c55e; }

        .hidden { display: none !important; }
        .content-page { display: none; }
        .content-page:not(.hidden) { display: block; }

    </style>
</head>
<body>

    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="scroll-lane scroll-left tiny"><div class="track"></div></div>
        <div class="scroll-lane scroll-right med"><div class="track"></div></div>
        <div class="scroll-lane scroll-left"><div class="track"></div></div>
        <div class="scroll-lane scroll-right huge"><div class="track"></div></div>
        <div class="scroll-lane scroll-left tiny"><div class="track"></div></div>
        <div class="scroll-lane scroll-right"><div class="track"></div></div>
        <div class="scroll-lane scroll-left med"><div class="track"></div></div>
        <div class="scroll-lane scroll-right tiny"><div class="track"></div></div>
        <div class="scroll-lane scroll-left"><div class="track"></div></div>
        <div class="scroll-lane scroll-right huge"><div class="track"></div></div>
        <div class="scroll-lane scroll-left tiny"><div class="track"></div></div>
        <div class="scroll-lane scroll-right med"><div class="track"></div></div>
        <div class="scroll-lane scroll-left"><div class="track"></div></div>
        <div class="scroll-lane scroll-right tiny"><div class="track"></div></div>
        <div class="scroll-lane scroll-left med"><div class="track"></div></div>
    </div>

    <div class="vertical-container">
        <div class="scroll-lane vertical-lane scroll-down v-1"><div class="track"></div></div>
        <div class="scroll-lane vertical-lane scroll-up v-2"><div class="track"></div></div>
        <div class="scroll-lane vertical-lane scroll-down v-3"><div class="track"></div></div>
        <div class="scroll-lane vertical-lane scroll-up v-4"><div class="track"></div></div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div id="loginCard" class="auth-card">
            <h1>Legal Terminal</h1>
            <div class="auth-options">
                <button onclick="showAuth('login')">Login</button>
                <button onclick="showAuth('signup')">Sign Up</button>
            </div>
            <form id="loginForm" onsubmit="login(event)">
                <div class="input-group">
                    <label>USER NAME</label>
                    <input type="email" id="loginEmail" placeholder="email@example.com" required>
                </div>
                <div class="input-group">
                    <label>PASSWORD</label>
                    <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit">Submit Evidence</button>
            </form>
        </div>

        <div id="signupCard" class="auth-card hidden">
            <h1>Create Account</h1>
            <div class="auth-options">
                <button onclick="showAuth('login')">Login</button>
                <button onclick="showAuth('signup')">Sign Up</button>
            </div>
            <form id="signupForm" onsubmit="signup(event)">
                <div class="input-group">
                    <label>FULL NAME</label>
                    <input type="text" id="signupName" placeholder="Username" required>
                </div>
                <div class="input-group">
                    <label>USER NAME</label>
                    <input type="email" id="signupEmail" placeholder="example@gmail.com" required>
                </div>
                <div class="input-group">
                    <label>PASSWORD</label>
                    <input type="password" id="signupPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit">Create Account</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app">
        <nav class="top-nav">
            <div class="logo">
                <span>Legal Analysis AI</span>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <span id="userName">John Doe</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>

        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Main</div>
                <div class="sidebar-item active" onclick="navigateTo('dashboard')">
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('upload')">
                    <span>Upload Document</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('viewer')">
                    <span>Document Viewer</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('analysis')">
                    <span>Risk Analysis</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="dashboardPage" class="content-page">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Overview of your legal document analysis</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <p class="stat-label">Total Documents</p>
                                <p class="stat-value" id="totalDocsVal">0</p>
                            </div>
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üìÑ</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <p class="stat-label">High Risk Clauses</p>
                                <p class="stat-value" id="highRiskVal">0</p>
                            </div>
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);">‚ö†Ô∏è</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <p class="stat-label">Analyzed This Month</p>
                                <p class="stat-value" id="monthVal">0</p>
                            </div>
                            <div class="stat-icon" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">‚úÖ</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="uploadPage" class="content-page hidden">
                <div class="page-header">
                    <h1 class="page-title">Upload Document</h1>
                </div>
                <div class="upload-section">
                    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                        <p style="font-size: 1.125rem; font-weight: 600;">Click to Upload or Drag & Drop</p>
                        <input type="file" id="fileInput" style="display: none;" accept=".pdf,.docx" onchange="handleFileSelect(event)">
                    </div>
                    <p id="uploadStatus" style="text-align: center; margin-top: 10px; color: #667eea;"></p>
                </div>
            </div>

            <div id="analysisPage" class="content-page hidden">
                <div class="page-header">
                    <h1 class="page-title">Risk Analysis</h1>
                    <p class="page-subtitle">AI-powered clause analysis and risk assessment</p>
                </div>
                <div id="analysisContainer">
                    <p style="text-align: center; color: #718096; margin-top: 50px;">Please upload a document to see analysis.</p>
                </div>
            </div>

            <!-- New: Viewer page for displaying uploaded files -->
            <div id="viewerPage" class="content-page hidden">
                <div class="page-header">
                    <h1 class="page-title">Document Viewer</h1>
                    <p class="page-subtitle">View your uploaded document</p>
                </div>
                <div id="viewerContainer">
                    <iframe id="fileViewer" style="width: 100%; height: 600px; border: none;"></iframe>
                    <button onclick="navigateTo('analysis')" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 4px;">Analyze Document</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const legalText = `
            LEGAL DOCUMENTS OFTEN CONTAIN <span class="keyword">AFFIDAVIT</span> <span class="def">confirmed by oath</span> // 
            <span class="keyword">PLAINTIFF</span> WHO INITIATES LAWSUIT // 
            <span class="keyword">DEFENDANT</span> AGAINST WHOM FILED // 
            <span class="keyword">CONTRACT</span> <span class="meta">LEGALLY BINDING</span> // 
            <span class="keyword">STATUTE</span> PASSED BY LEGISLATIVE BODY // 
            <span class="keyword">LIABILITY</span> RESPONSIBILITY FOR ACTIONS // 
            <span class="keyword">INDEMNITY</span> OBLIGATION TO COMPENSATE // 
            <span class="keyword">JURISDICTION</span> AUTHORITY TO ADMINISTER JUSTICE // 
            <span class="keyword">TESTAMENT</span> PERSON'S WILL PROPERTY // 
            <span class="keyword">TORT</span> WRONGFUL ACT LIABILITY // 
        `;

        const tracks = document.querySelectorAll('.track');

        tracks.forEach(track => {
            let content = '';
            for(let i=0; i<6; i++) {
                content += `<span>${legalText}</span>`;
            }
            track.innerHTML = content;
        });

        // Check authentication on page load
        window.addEventListener('load', async () => {
            if (window.location.hash === '#loggedin') {
                try {
                    const res = await fetch('/api/user');
                    const data = await res.json();
                    if (data.user) {
                        document.getElementById('userName').textContent = data.user.name;
                        document.getElementById('userAvatar').textContent = data.user.name.charAt(0);
                        document.getElementById('authContainer').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        document.body.style.overflow = 'auto';
                        loadStats();
                        // Clear the hash
                        history.replaceState(null, null, ' ');
                    }
                } catch (err) {
                    console.log('Not authenticated');
                }
            }
        });

        // Auth functions
        function showAuth(type) {
            document.getElementById('loginCard').classList.toggle('hidden', type !== 'login');
            document.getElementById('signupCard').classList.toggle('hidden', type !== 'signup');
        }

        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (data.success) {
                    document.getElementById('userName').textContent = data.user.name;
                    document.getElementById('userAvatar').textContent = data.user.name.charAt(0);
                    document.getElementById('authContainer').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    document.body.style.overflow = 'auto';
                    loadStats();
                } else {
                    alert(data.error);
                }
            } catch (err) { alert("Server error"); }
        }

        async function signup(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPass').value;

            try {
                const res = await fetch('/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await res.json();
                if (data.success) {
                    alert("Account created! Please login.");
                    showAuth('login');
                } else {
                    alert(data.error);
                }
            } catch (err) { alert("Server error"); }
        }

        function logout() {
            window.location.href = '/logout';
        }

        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.content-page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.getElementById(page + 'Page').classList.remove('hidden');
            event.target.classList.add('active');
            if(page === 'dashboard') loadStats();
        }

        // Updated: File upload now redirects to viewer
        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const status = document.getElementById('uploadStatus');
            status.textContent = `Uploading ${file.name}... Please wait...`;

            const formData = new FormData();
            formData.append('document', file);

            try {
                const res = await fetch('/api/analyze', { method: 'POST', body: formData });
                const result = await res.json();

                // New: Render viewer with the file URL
                renderViewer(result.fileUrl);
                status.textContent = "";
                navigateTo('viewer');
            } catch (err) {
                status.textContent = "Upload failed.";
                console.error(err);
            }
        }

        // New: Function to display the file in the viewer
        function renderViewer(fileUrl) {
            const iframe = document.getElementById('fileViewer');
            iframe.src = fileUrl;
        }

        function renderAnalysis(data) {
            const container = document.getElementById('analysisContainer');
            container.innerHTML = '';

            data.clauses.forEach(clause => {
                let color = '#22c55e';
                if (clause.risk === 'High') color = '#f97316';
                if (clause.risk === 'Critical') color = '#dc2626';

                const html = `
                    <div class="clause-card" style="border-left-color: ${color};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <h3 style="font-size: 1.125rem; font-weight: 600;">${clause.title}</h3>
                            <span class="risk-badge" style="background:${color}20; color:${color}">${clause.risk} Risk</span>
                        </div>
                        <p style="color: #4a5568; margin-bottom: 1rem;">"${clause.text}"</p>
                        <p style="color: #718096; font-size: 0.875rem;"><strong>AI Analysis:</strong> ${clause.explanation}</p>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        async function loadStats() {
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                document.getElementById('totalDocsVal').textContent = data.totalDocs;
                document.getElementById('highRiskVal').textContent = data.highRisk;
                document.getElementById('monthVal').textContent = data.analyzedMonth;
            } catch (err) { console.log("Stats error"); }
        }
    </script>
</body>
</html>